<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">目标检测模型部署 | 东山Π</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://wiki.dshanpi.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://wiki.dshanpi.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://wiki.dshanpi.org/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="目标检测模型部署 | 东山Π"><meta data-rh="true" name="description" content="参考资料："><meta data-rh="true" property="og:description" content="参考资料："><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wiki.dshanpi.org/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep"><link data-rh="true" rel="alternate" href="https://wiki.dshanpi.org/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://wiki.dshanpi.org/en/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep" hreflang="en"><link data-rh="true" rel="alternate" href="https://wiki.dshanpi.org/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e3ab61ce.css">
<script src="/assets/js/runtime~main.93a58365.js" defer="defer"></script>
<script src="/assets/js/main.4da8f2b0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">东山Π</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/DshanPi-A1/intro">DshanPi-A1</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/dshanpi/Docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/DshanPi-A1/intro">DshanPi-A1 产品简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/DshanPi-A1/ResourceAcquisition">开发资料汇总</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/category/系统安装">系统安装</a><button aria-label="折叠侧边栏分类 &#x27;系统安装&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part1/01-1_HardwareConnectionGuide">硬件连接指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part1/01-2_SerialTerminal">连接串口终端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part1/01-3_Flash2eMMC">烧录系统至EMMC</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/category/系统使用">系统使用</a><button aria-label="折叠侧边栏分类 &#x27;系统使用&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part2/02-1_InitialBootSetup">首次启动设置引导</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part2/02-2_NetworkConnectionGuide">网络连接引导</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part2/02-3_RemoteSSHTerminal">远程登录SSH终端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part2/02-4_FileTransfer">文件传输</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/应用开发">应用开发</a><button aria-label="折叠侧边栏分类 &#x27;应用开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/docs/category/摄像头与显示应用">摄像头与显示应用</a><button aria-label="折叠侧边栏分类 &#x27;摄像头与显示应用&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part3/part3-1/03-1-1_OpenCVApplications">OpenCV</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/docs/category/多媒体应用">多媒体应用</a><button aria-label="折叠侧边栏分类 &#x27;多媒体应用&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part3/part3-2/03-2-1_VideoCodec">视频编解码</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/ai进阶应用">AI进阶应用</a><button aria-label="折叠侧边栏分类 &#x27;AI进阶应用&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part3/part3-3/03-2-1_SetupRKNNEnvironment">RKNN环境搭建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part3/part3-3/03-2-2_FaceDetectionModelDep">人脸检测模型部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part3/part3-3/03-2-3_HumanShapeDetectionModelDep">人形检测模型部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep">目标检测模型部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part3/part3-3/03-2-5_InstanceSegmentationModelDep">实例分割模型部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part3/part3-3/03-2-6_RotationalObjectDetectionModelDep">旋转目标检测模型部署</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/docs/category/qt5应用开发">QT5应用开发</a><button aria-label="折叠侧边栏分类 &#x27;QT5应用开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DshanPi-A1/part3/part3-4/03-4-1_SettingQt5DevelopmentEnvironment">开发环境搭建</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/应用开发"><span itemprop="name">应用开发</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/ai进阶应用"><span itemprop="name">AI进阶应用</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">目标检测模型部署</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>目标检测  模型部署</h1>
<p>参考资料：</p>
<ul>
<li>模型仓库：<a href="https://github.com/airockchip/ultralytics_yolov8" target="_blank" rel="noopener noreferrer">https://github.com/airockchip/ultralytics_yolov8</a></li>
<li>模型源码资料包（国内用户推荐）：<a href="https://dl.100ask.net/Hardware/MPU/RK3576-DshanPi-A1/utils/ultralytics_yolov8.zip" target="_blank" rel="noopener noreferrer">https://dl.100ask.net/Hardware/MPU/RK3576-DshanPi-A1/utils/ultralytics_yolov8.zip</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1获取原始模型">1.获取原始模型<a href="#1获取原始模型" class="hash-link" aria-label="1.获取原始模型的直接链接" title="1.获取原始模型的直接链接">​</a></h2>
<p>1.进入目标检测模型仓库：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/airockchip/ultralytics_yolov8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ultralytics_yolov8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2.使用conda创建环境</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda create -name yolov8 python=3.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda activate yolov8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3.安装yolov8相关依赖</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip3 install torch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1 ultralytics==8.3.31 onnx==1.17.0 onnxruntime==1.8.0 onnxsim==0.4.36</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>4.导出ONNX模型</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python ultralytics/engine/exporter.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果无法下载模型可直接访问<a href="https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8n.pt" target="_blank" rel="noopener noreferrer">yolov8n.pt</a>，下载后放在<code>ultralytics_yolov8</code>目录下，再次执行。</p>
<p>运行效果如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(yolov8) baiwen@dshanpi-a1:~/ultralytics_yolov8$ python ultralytics/engine/exporter.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ultralytics YOLOv8.2.82 🚀 Python-3.9.23 torch-2.4.1 CPU (Cortex-A53)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YOLOv8n summary (fused): 168 layers, 3,151,904 parameters, 0 gradients, 8.7 GFLOPs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PyTorch: starting from &#x27;yolov8n.pt&#x27; with input shape (16, 3, 640, 640) BCHW and output shape(s) ((16, 64, 80, 80), (16, 80, 80, 80), (16, 1, 80, 80), (16, 64, 40, 40), (16, 80, 40, 40), (16, 1, 40, 40), (16, 64, 20, 20), (16, 80, 20, 20), (16, 1, 20, 20)) (6.2 MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RKNN: starting export with torch 2.4.1...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RKNN: feed yolov8n.onnx to RKNN-Toolkit or RKNN-Toolkit2 to generate RKNN model.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Refer https://github.com/airockchip/rknn_model_zoo/tree/main/models/CV/object_detection/yolo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RKNN: export success ✅ 2.8s, saved as &#x27;yolov8n.onnx&#x27; (12.1 MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Export complete (24.8s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Results saved to /home/baiwen/ultralytics_yolov8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Predict:         yolo predict task=detect model=yolov8n.onnx imgsz=640</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Validate:        yolo val task=detect model=yolov8n.onnx imgsz=640 data=coco.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Visualize:       https://netron.app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行完成后可以在当前目录下看到ONNX模型文件<code>yolov8n.onnx</code>。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(yolov8) baiwen@dshanpi-a1:~/ultralytics_yolov8$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CITATION.cff     docker  examples  mkdocs.yml      README.md        RKOPT_README.md        tests        ultralytics.egg-info  yolov8n.pt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTRIBUTING.md  docs    LICENSE   pyproject.toml  README.zh-CN.md  RKOPT_README.zh-CN.md  ultralytics  yolov8n.onnx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将导出的ONNX模型拷贝至yolov8模型目录。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp yolov8n.onnx ~/Projects/rknn_model_zoo/examples/yolov8/model</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2模型转换">2.模型转换<a href="#2模型转换" class="hash-link" aria-label="2.模型转换的直接链接" title="2.模型转换的直接链接">​</a></h2>
<p>1.使用Conda激活<code>rknn-toolkit2</code>环境</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda activate rknn-toolkit2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2.进入yolov8模型转换目录</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/Projects/rknn_model_zoo/examples/yolov8/python</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3.执行模型转换</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 convert.py ../model/yolov8n.onnx rk3576</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行效果如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(rknn-toolkit2) baiwen@dshanpi-a1:~/Projects/rknn_model_zoo/examples/yolov8/python$ python3 convert.py ../model/yolov8n.onnx rk3576</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I rknn-toolkit2 version: 2.3.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; Config model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; Loading model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I Loading : 100%|███████████████████████████████████████████████| 126/126 [00:00&lt;00:00, 9216.48it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; Building model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I OpFusing 0: 100%|██████████████████████████████████████████████| 100/100 [00:00&lt;00:00, 173.69it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I OpFusing 1 : 100%|██████████████████████████████████████████████| 100/100 [00:01&lt;00:00, 99.72it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I OpFusing 0 : 100%|██████████████████████████████████████████████| 100/100 [00:01&lt;00:00, 84.03it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I OpFusing 1 : 100%|██████████████████████████████████████████████| 100/100 [00:01&lt;00:00, 74.45it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I OpFusing 2 : 100%|██████████████████████████████████████████████| 100/100 [00:03&lt;00:00, 26.99it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: found outlier value, this may affect quantization accuracy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        const name                        abs_mean    abs_std     outlier value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        model.0.conv.weight               2.44        2.47        -17.494</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        model.22.cv3.2.1.conv.weight      0.09        0.14        -10.215</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        model.22.cv3.1.1.conv.weight      0.12        0.19        13.361, 13.317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        model.22.cv3.0.1.conv.weight      0.18        0.20        -11.216</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I GraphPreparing : 100%|█████████████████████████████████████████| 161/161 [00:00&lt;00:00, 854.69it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I Quantizating : 100%|████████████████████████████████████████████| 161/161 [00:32&lt;00:00,  4.91it/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default input dtype of &#x27;images&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;318&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;onnx::ReduceSum_326&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;331&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;338&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;onnx::ReduceSum_346&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;350&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;357&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;onnx::ReduceSum_365&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W build: The default output dtype of &#x27;369&#x27; is changed from &#x27;float32&#x27; to &#x27;int8&#x27; in rknn model for performance!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      Please take care of this change when deploy rknn model with Runtime API!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I rknn building ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I rknn building done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; Export rknn model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到转换完成后在model目录下看到端侧的RKNN模型。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(rknn-toolkit2) baiwen@dshanpi-a1:~/Projects/rknn_model_zoo/examples/yolov8/python$ ls ../model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bus.jpg  coco_80_labels_list.txt  dataset.txt  download_model.sh  yolov8n.onnx  yolov8.rknn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3模型推理">3.模型推理<a href="#3模型推理" class="hash-link" aria-label="3.模型推理的直接链接" title="3.模型推理的直接链接">​</a></h2>
<p>执行推理测试代码：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 yolov8.py --model_path ../model/yolov8.rknn --target rk3576 --img_show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行效果如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(rknn-toolkit2) baiwen@dshanpi-a1:~/Projects/rknn_model_zoo/examples/yolov8/python$ python3 yolov8.py --model_path ../model/yolov8.rknn --target rk3576</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I rknn-toolkit2 version: 2.3.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; Init runtime environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I target set by user is: rk3576</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Model-../model/yolov8.rknn is rknn model, starting val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W inference: The &#x27;data_format&#x27; is not set, and its default value is &#x27;nhwc&#x27;!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行后会弹出下图所示的检测结果图：</p>
<p><img loading="lazy" alt="image-20250819151219428" src="/assets/images/image-20250819151219428-fe3b439bb2f200e09b17b391927791b1.png" width="640" height="640" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4视频流推理">4.视频流推理<a href="#4视频流推理" class="hash-link" aria-label="4.视 频流推理的直接链接" title="4.视频流推理的直接链接">​</a></h2>
<blockquote>
<p>开始前请注意，请务必接入USB摄像头，并确认/dev/目录下存在video0设备节点！！！</p>
</blockquote>
<p>1.新建程序文件<code>yolov8_video.py.py</code>,填入一下内容：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import argparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">realpath = os.path.abspath(__file__)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_sep = os.path.sep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">realpath = realpath.split(_sep)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys.path.append(os.path.join(realpath[0]+_sep, *realpath[1:realpath.index(&#x27;rknn_model_zoo&#x27;)+1]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from py_utils.coco_utils import COCO_test_helper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OBJ_THRESH = 0.25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NMS_THRESH = 0.45</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># The follew two param is for map test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OBJ_THRESH = 0.001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># NMS_THRESH = 0.65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IMG_SIZE = (640, 640)  # (width, height), such as (1280, 736)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLASSES = (&quot;person&quot;, &quot;bicycle&quot;, &quot;car&quot;,&quot;motorbike &quot;,&quot;aeroplane &quot;,&quot;bus &quot;,&quot;train&quot;,&quot;truck &quot;,&quot;boat&quot;,&quot;traffic light&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &quot;fire hydrant&quot;,&quot;stop sign &quot;,&quot;parking meter&quot;,&quot;bench&quot;,&quot;bird&quot;,&quot;cat&quot;,&quot;dog &quot;,&quot;horse &quot;,&quot;sheep&quot;,&quot;cow&quot;,&quot;elephant&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &quot;bear&quot;,&quot;zebra &quot;,&quot;giraffe&quot;,&quot;backpack&quot;,&quot;umbrella&quot;,&quot;handbag&quot;,&quot;tie&quot;,&quot;suitcase&quot;,&quot;frisbee&quot;,&quot;skis&quot;,&quot;snowboard&quot;,&quot;sports ball&quot;,&quot;kite&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &quot;baseball bat&quot;,&quot;baseball glove&quot;,&quot;skateboard&quot;,&quot;surfboard&quot;,&quot;tennis racket&quot;,&quot;bottle&quot;,&quot;wine glass&quot;,&quot;cup&quot;,&quot;fork&quot;,&quot;knife &quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &quot;spoon&quot;,&quot;bowl&quot;,&quot;banana&quot;,&quot;apple&quot;,&quot;sandwich&quot;,&quot;orange&quot;,&quot;broccoli&quot;,&quot;carrot&quot;,&quot;hot dog&quot;,&quot;pizza &quot;,&quot;donut&quot;,&quot;cake&quot;,&quot;chair&quot;,&quot;sofa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &quot;pottedplant&quot;,&quot;bed&quot;,&quot;diningtable&quot;,&quot;toilet &quot;,&quot;tvmonitor&quot;,&quot;laptop	&quot;,&quot;mouse	&quot;,&quot;remote &quot;,&quot;keyboard &quot;,&quot;cell phone&quot;,&quot;microwave &quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &quot;oven &quot;,&quot;toaster&quot;,&quot;sink&quot;,&quot;refrigerator &quot;,&quot;book&quot;,&quot;clock&quot;,&quot;vase&quot;,&quot;scissors &quot;,&quot;teddy bear &quot;,&quot;hair drier&quot;, &quot;toothbrush &quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coco_id_list = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 27, 28, 31, 32, 33, 34,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         64, 65, 67, 70, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 84, 85, 86, 87, 88, 89, 90]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def filter_boxes(boxes, box_confidences, box_class_probs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Filter boxes with object threshold.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    box_confidences = box_confidences.reshape(-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    candidate, class_num = box_class_probs.shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    class_max_score = np.max(box_class_probs, axis=-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classes = np.argmax(box_class_probs, axis=-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _class_pos = np.where(class_max_score* box_confidences &gt;= OBJ_THRESH)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scores = (class_max_score* box_confidences)[_class_pos]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boxes = boxes[_class_pos]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classes = classes[_class_pos]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return boxes, classes, scores</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def nms_boxes(boxes, scores):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Suppress non-maximal boxes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keep: ndarray, index of effective boxes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x = boxes[:, 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y = boxes[:, 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w = boxes[:, 2] - boxes[:, 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    h = boxes[:, 3] - boxes[:, 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    areas = w * h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order = scores.argsort()[::-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keep = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while order.size &gt; 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        i = order[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keep.append(i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xx1 = np.maximum(x[i], x[order[1:]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yy1 = np.maximum(y[i], y[order[1:]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xx2 = np.minimum(x[i] + w[i], x[order[1:]] + w[order[1:]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yy2 = np.minimum(y[i] + h[i], y[order[1:]] + h[order[1:]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        w1 = np.maximum(0.0, xx2 - xx1 + 0.00001)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        h1 = np.maximum(0.0, yy2 - yy1 + 0.00001)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inter = w1 * h1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ovr = inter / (areas[i] + areas[order[1:]] - inter)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inds = np.where(ovr &lt;= NMS_THRESH)[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order = order[inds + 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keep = np.array(keep)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return keep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def dfl(position):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Distribution Focal Loss (DFL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import torch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x = torch.tensor(position)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n,c,h,w = x.shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p_num = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mc = c//p_num</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y = x.reshape(n,p_num,mc,h,w)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y = y.softmax(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    acc_metrix = torch.tensor(range(mc)).float().reshape(1,1,mc,1,1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y = (y*acc_metrix).sum(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return y.numpy()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def box_process(position):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grid_h, grid_w = position.shape[2:4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    col, row = np.meshgrid(np.arange(0, grid_w), np.arange(0, grid_h))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    col = col.reshape(1, 1, grid_h, grid_w)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    row = row.reshape(1, 1, grid_h, grid_w)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grid = np.concatenate((col, row), axis=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stride = np.array([IMG_SIZE[1]//grid_h, IMG_SIZE[0]//grid_w]).reshape(1,2,1,1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    position = dfl(position)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    box_xy  = grid +0.5 -position[:,0:2,:,:]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    box_xy2 = grid +0.5 +position[:,2:4,:,:]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyxy = np.concatenate((box_xy*stride, box_xy2*stride), axis=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return xyxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def post_process(input_data):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boxes, scores, classes_conf = [], [], []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    defualt_branch=3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pair_per_branch = len(input_data)//defualt_branch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Python 忽略 score_sum 输出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(defualt_branch):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boxes.append(box_process(input_data[pair_per_branch*i]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        classes_conf.append(input_data[pair_per_branch*i+1])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scores.append(np.ones_like(input_data[pair_per_branch*i+1][:,:1,:,:], dtype=np.float32))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def sp_flatten(_in):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ch = _in.shape[1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _in = _in.transpose(0,2,3,1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return _in.reshape(-1, ch)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boxes = [sp_flatten(_v) for _v in boxes]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classes_conf = [sp_flatten(_v) for _v in classes_conf]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scores = [sp_flatten(_v) for _v in scores]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boxes = np.concatenate(boxes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classes_conf = np.concatenate(classes_conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scores = np.concatenate(scores)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # filter according to threshold</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boxes, classes, scores = filter_boxes(boxes, scores, classes_conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # nms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nboxes, nclasses, nscores = [], [], []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for c in set(classes):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inds = np.where(classes == c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b = boxes[inds]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c = classes[inds]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        s = scores[inds]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keep = nms_boxes(b, s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if len(keep) != 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nboxes.append(b[keep])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nclasses.append(c[keep])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nscores.append(s[keep])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if not nclasses and not nscores:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return None, None, None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boxes = np.concatenate(nboxes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classes = np.concatenate(nclasses)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scores = np.concatenate(nscores)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return boxes, classes, scores</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def draw(image, boxes, scores, classes):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for box, score, cl in zip(boxes, scores, classes):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        top, left, right, bottom = [int(_b) for _b in box]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;%s @ (%d %d %d %d) %.3f&quot; % (CLASSES[cl], top, left, right, bottom, score))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2.rectangle(image, (top, left), (right, bottom), (255, 0, 0), 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2.putText(image, &#x27;{0} {1:.2f}&#x27;.format(CLASSES[cl], score),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    (top, left - 6), cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0, 0, 255), 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def setup_model(args):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_path = args.model_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if model_path.endswith(&#x27;.pt&#x27;) or model_path.endswith(&#x27;.torchscript&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform = &#x27;pytorch&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from py_utils.pytorch_executor import Torch_model_container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model = Torch_model_container(args.model_path)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elif model_path.endswith(&#x27;.rknn&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform = &#x27;rknn&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from py_utils.rknn_executor import RKNN_model_container </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model = RKNN_model_container(args.model_path, args.target, args.device_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elif model_path.endswith(&#x27;onnx&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        platform = &#x27;onnx&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from py_utils.onnx_executor import ONNX_model_container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model = ONNX_model_container(args.model_path)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assert False, &quot;{} is not rknn/pytorch/onnx model&quot;.format(model_path)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&#x27;Model-{} is {} model, starting val&#x27;.format(model_path, platform))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return model, platform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def img_check(path):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    img_type = [&#x27;.jpg&#x27;, &#x27;.jpeg&#x27;, &#x27;.png&#x27;, &#x27;.bmp&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for _type in img_type:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if path.endswith(_type) or path.endswith(_type.upper()):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser = argparse.ArgumentParser(description=&#x27;YOLOv8-Seg Real-time Demo&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&#x27;--model_path&#x27;, type=str, required=True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        help=&#x27;model path, could be .pt or .rknn file&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&#x27;--target&#x27;, type=str, default=&#x27;rk3566&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        help=&#x27;target RKNPU platform&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&#x27;--device_id&#x27;, type=str, default=None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        help=&#x27;device id&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args = parser.parse_args()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 1. 初始化模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model, platform = setup_model(args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&#x27;Model ready.&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 2. 打开摄像头</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cap = cv2.VideoCapture(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if not cap.isOpened():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;Cannot open camera.&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exit(-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 3. 实时循环</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while True:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret, frame = cap.read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if not ret:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        h0, w0 = frame.shape[:2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 3-1 LetterBox 预处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        co_helper = COCO_test_helper(enable_letter_box=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img = co_helper.letter_box(frame.copy(), IMG_SIZE, pad_color=(0, 0, 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 3-2 构造输入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if platform in [&#x27;pytorch&#x27;, &#x27;onnx&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            input_data = img.transpose(2, 0, 1).astype(np.float32) / 255.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            input_data = np.expand_dims(input_data, 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            input_data = img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 3-3 推理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outputs = model.run([input_data])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boxes, classes, scores = post_process(outputs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 3-4 画框</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vis = frame.copy()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if boxes is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            boxes_real = co_helper.get_real_box(boxes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            draw(vis, boxes_real, scores, classes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 3-5 实时显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2.imshow(&#x27;YOLOv8&#x27;, vis)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if cv2.waitKey(1) &amp; 0xFF == ord(&#x27;q&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cap.release()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2.destroyAllWindows()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model.release()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行如下命令推理：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 yolov8_video.py --model_path ../model/yolov8.rknn --target rk3576</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/100askTeam/linuxboard-docs/tree/main/docs/DshanPi-A1/part3/part3-3/03-2-4_TargetDetectionModelDep.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DshanPi-A1/part3/part3-3/03-2-3_HumanShapeDetectionModelDep"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">人形检测模型部署</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DshanPi-A1/part3/part3-3/03-2-5_InstanceSegmentationModelDep"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">实例分割模型部署</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1获取原始模型" class="table-of-contents__link toc-highlight">1.获取原始模型</a></li><li><a href="#2模型转换" class="table-of-contents__link toc-highlight">2.模型转换</a></li><li><a href="#3模型推理" class="table-of-contents__link toc-highlight">3.模型推理</a></li><li><a href="#4视频流推理" class="table-of-contents__link toc-highlight">4.视频流推理</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>